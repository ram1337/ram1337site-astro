---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type Post = CollectionEntry<"posts">;

const posts = (await getCollection("posts")) as Post[];

const tagCounts = new Map<string, number>();

for (const post of posts) {
  for (const tag of post.data.tags ?? []) {
    if (!tag) continue;
    const key = tag.trim();
    if (!key) continue;
    tagCounts.set(key, (tagCounts.get(key) ?? 0) + 1);
  }
}

const tags = Array.from(tagCounts.entries()).sort((a, b) =>
  a[0].localeCompare(b[0], "ru")
);
---

<BaseLayout title="Теги — ram1337" description="Список тегов блога Рамиля.">
  <section class="space-y-4">
    <header class="space-y-2">
      <p
        class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-500 dark:text-slate-400"
      >
        /tag
      </p>
      <h1
        class="text-2xl font-bold tracking-tight text-slate-900 dark:text-slate-50"
      >
        Теги
      </h1>
      <p class="text-sm text-slate-600 dark:text-slate-400">
        Быстрый способ найти записи по теме. Не идеальный поиск, но лучше, чем
        крутить колёсико мыши в никуда.
      </p>
    </header>

    {
      tags.length === 0 ? (
        <p class="text-sm text-slate-600 dark:text-slate-400">
          Тегов пока нет — сначала надо что-нибудь написать.
        </p>
      ) : (
        <div class="mt-4 flex flex-wrap gap-2">
          {tags.map(([tag, count]) => (
            <a
              href={`/tag/${encodeURIComponent(tag)}/`}
              class="inline-flex items-center gap-2 rounded-full border border-slate-300 bg-slate-100
                   px-3 py-1 text-xs font-medium text-slate-700 transition
                   hover:border-violet-400 hover:text-violet-700
                   dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200
                   dark:hover:border-violet-400 dark:hover:text-violet-100"
            >
              <span>#{tag}</span>
              <span class="text-[0.7rem] text-slate-500 dark:text-slate-400">
                {count}
              </span>
            </a>
          ))}
        </div>
      )
    }
  </section>
</BaseLayout>
