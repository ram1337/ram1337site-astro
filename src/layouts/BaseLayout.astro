---
import "../styles/global.css";

type Props = {
  title: string;
  description?: string;
  image?: string;
};

const {
  title,
  description = "ram1337 –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π—Ç",
  image = "/og/default.jpg",
} = Astro.props as Props;

const canonical = new URL(Astro.url.pathname, Astro.site);
const ogImage = image.startsWith("http")
  ? image
  : new URL(image, Astro.site).toString();
---

<html lang="ru" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    {/* Open Graph */}
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="ram1337" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical.toString()} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    {/* Twitter */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <script is:inline>
      (function () {
        try {
          const stored = localStorage.getItem("theme");
          const systemPrefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          const theme = stored || (systemPrefersDark ? "dark" : "light");
          const root = document.documentElement;

          if (theme === "dark") {
            root.classList.add("dark");
          } else {
            root.classList.remove("dark");
          }
        } catch (e) {}
      })();
    </script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
      (function (m, e, t, r, i, k, a) {
        m[i] =
          m[i] ||
          function () {
            (m[i].a = m[i].a || []).push(arguments);
          };
        m[i].l = 1 * new Date();
        for (var j = 0; j < document.scripts.length; j++) {
          if (document.scripts[j].src === r) {
            return;
          }
        }
        ((k = e.createElement(t)),
          (a = e.getElementsByTagName(t)[0]),
          (k.async = 1),
          (k.src = r),
          a.parentNode.insertBefore(k, a));
      })(
        window,
        document,
        "script",
        "https://mc.yandex.ru/metrika/tag.js?id=94692701",
        "ym"
      );

      ym(94692701, "init", {
        ssr: true,
        clickmap: true,
        accurateTrackBounce: true,
        trackLinks: true,
      });
    </script>
    <noscript
      ><div>
        <img
          src="https://mc.yandex.ru/watch/94692701"
          style="position:absolute; left:-9999px;"
          alt=""
        />
      </div></noscript
    >
    <!-- /Yandex.Metrika counter -->
  </head>
  <body
    class="min-h-screen flex flex-col bg-slate-50 text-slate-900
           dark:bg-slate-950 dark:text-slate-100"
  >
    <header
      class="sticky top-0 z-20 border-b border-slate-200 bg-slate-50/90 backdrop-blur
             dark:border-slate-800 dark:bg-slate-950/80"
    >
      <div
        class="mx-auto flex max-w-3xl items-center justify-between px-4 py-3"
      >
        <a
          href="/"
          class="rounded-full border border-slate-300/60 px-3 py-1
       text-xs font-mono text-slate-600
       dark:border-slate-700 dark:text-slate-300"
        >
          /home/ram1337/
        </a>

        <nav
          class="flex items-center gap-3 text-sm text-slate-600 dark:text-slate-300"
        >
          <a
            href="/posts/"
            class="transition-colors hover:text-violet-500 dark:hover:text-violet-300"
          >
            –ü–æ—Å—Ç—ã
          </a>
          <a
            href="/tag/"
            class="transition-colors hover:text-violet-500 dark:hover:text-violet-300"
          >
            –¢–µ–≥–∏
          </a>
          <a
            href="/about/"
            class="transition-colors hover:text-violet-500 dark:hover:text-violet-300"
          >
            –ö–æ–Ω—Ç–∞–∫—Ç—ã
          </a>

          <button
            id="theme-toggle"
            type="button"
            class="ml-2 inline-flex h-8 w-8 items-center justify-center rounded-full
                   border border-slate-200 bg-white text-slate-700 text-sm
                   shadow-sm transition hover:border-violet-400 hover:text-violet-600
                   dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200
                   dark:hover:border-violet-400 dark:hover:text-violet-200"
            aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
          >
            <span id="theme-icon-sun" class="hidden">‚òÄÔ∏è</span>
            <span id="theme-icon-moon" class="hidden">üåô</span>
          </button>
        </nav>
      </div>
    </header>

    <main class="flex-1">
      <div class="mx-auto max-w-3xl px-4 py-10">
        <slot />
      </div>
    </main>

    <footer
      class="border-t border-slate-200 bg-slate-50/90 text-slate-500
             dark:border-slate-800 dark:bg-slate-950/90 dark:text-slate-500"
    >
      <div class="mx-auto max-w-3xl px-4 py-4 text-center text-xs">
        ¬© {new Date().getFullYear()} /home/ram1337. –°–¥–µ–ª–∞–Ω–æ –Ω–∞ Astro.
      </div>
    </footer>

    <script is:inline>
      (function () {
        const root = document.documentElement;
        const btn = document.getElementById("theme-toggle");
        const sun = document.getElementById("theme-icon-sun");
        const moon = document.getElementById("theme-icon-moon");

        if (!btn || !sun || !moon) return;

        function getCurrentTheme() {
          if (root.classList.contains("dark")) return "dark";
          return "light";
        }

        function applyIcon(theme) {
          if (theme === "dark") {
            sun.classList.remove("hidden");
            moon.classList.add("hidden");
          } else {
            sun.classList.add("hidden");
            moon.classList.remove("hidden");
          }
        }

        applyIcon(getCurrentTheme());

        btn.addEventListener("click", () => {
          const isDark = root.classList.toggle("dark");
          const theme = isDark ? "dark" : "light";

          try {
            localStorage.setItem("theme", theme);
          } catch (e) {}

          applyIcon(theme);
        });
      })();
    </script>
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("pre").forEach((pre) => {
          const btn = document.createElement("button");
          btn.textContent = "copy";
          btn.className = "copy-btn";

          btn.addEventListener("click", async () => {
            const code = pre.querySelector("code")?.innerText;
            if (!code) return;

            await navigator.clipboard.writeText(code);
            btn.textContent = "copied";
            setTimeout(() => (btn.textContent = "copy"), 1500);
          });

          pre.appendChild(btn);
        });
      });
    </script>
  </body>
</html>
